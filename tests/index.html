<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Refactored date examples</title>

    <link rel="stylesheet" href="../node_modules/qunitjs/qunit/qunit.css">
    <script src="../node_modules/qunitjs/qunit/qunit.js"></script>
    <script src="../node_modules/blanket/dist/qunit/blanket.min.js"></script>

    <!-- Deps -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js"></script>
    <script src="../examples/deps/jquery/dist/jquery.min.js"></script>
    <script src="../src/googlemaps-poi-loader.js" data-cover></script>
</head>
<body>

<div id="qunit"></div>

<div id="qunit-fixture">

    <ul class="filters">
        <li data-layer-url="http://happyfist.co/pois/pois/POI/gyms.kml"><a>Gyms</a></li>
        <li data-layer-url="http://happyfist.co/pois/pois/POI/hotels.kml"><a>Hotels</a></li>
    </ul>

    <div id="map-canvas"></div>

</div>

<script>
    var map;
    var kl;
    function initialize() {
        map = new google.maps.Map(document.getElementById('map-canvas'), {
            center: new google.maps.LatLng(40.751077, -73.945135),
            zoom: 13,
            mapTypeId: google.maps.MapTypeId.TERRAIN
        });

        QUnit.test("Initializing kmlLoader without required params", function(assert) {
            assert.throws(function() {
                new kmlLoader();
            }, Error('You must pass parameters to kmlLoader object.'), "Must throw error to pass");

            assert.throws(function() {
                new kmlLoader({});
            }, Error('Google map object must be passed as property of data parameter.'), "Must throw error to pass");

            assert.throws(function() {
                new kmlLoader({
                    map: map
                });
            }, Error('Array of DOM elements containing data-layer-url attribute must be passed as property of data parameter.'), "Must throw error to pass");

            assert.throws(function() {
                new kmlLoader({
                    filters: $('ul.filters li')
                });
            }, Error('Google map object must be passed as property of data parameter.'), "Must throw error to pass");


        });

        QUnit.test("Constructor works", function(assert) {
            var callbackVariable = "Just smth for test!";
            var $filters = $('ul.filters li');

            kl = new kmlLoader({
                map: map,
                filters: $filters,
                filterClickCallback: function() {
                    return callbackVariable;
                },
                setEvents: true,
                showOnLoad: true,
                onLayerChangeKeepState: true
            });

            assert.deepEqual(kl.map, map);
            assert.deepEqual(kl.filters, $filters);
            assert.equal(kl.callbackReturnValue, null);
            assert.equal(kl.kmlLayers.length, 2);
            kl.clearPreviousLayers();
//            console.log(kl.callbackReturnValue);
//            assert.equal(kl.callbackReturnValue, callbackVariable);

        });

        QUnit.test("Adding layers", function(assert) {
            var callbackVariable = "Just smth for test!";
            var $filters = $('ul.filters li');

            kl = new kmlLoader({
                map: map,
                filters: $filters,
                filterClickCallback: function() {
                    return callbackVariable;
                },
                setEvents: true,
                showOnLoad: true,
                onLayerChangeKeepState: true
            });
            console.log(kl.kmlLayers);

            assert.equal(kl.kmlLayers.length, 2);
//            kl.addLayer('http://happyfist.co/pois/pois/POI/gyms.kml');
//            assert.equal(kl.kmlLayers.length, 3);
        })
    }
    google.maps.event.addDomListener(window, 'load', initialize);

    function resetGoogleMap() {

    }

</script>
</body>
</html>